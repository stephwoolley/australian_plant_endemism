
title: Quantifying Australiaâ€™s Plant Endemicity Using Global Datasets. 

author: Stephanie Woolley z5284998

Package Installation:
```{r}
#package installation 
#remotes::install_github("traitecoevo/austraits", build_vignettes = FALSE)
#install.packages("treemap")
#install.packages("AUstraits")
#install.packages("dpylr")
#install.packages("RColorBrewer")
#install.packages("rnaturalearth")
#install.packages("rnaturalearthdata")
#install.packages("ggplot2")
library(austraits) 
library(dplyr)
library(treemap)
library("RColorBrewer")
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)
```

1. Initial data set collection :
```{r}
apc <- read_csv("data/apc_native_only_mesaglio_6jun.csv")
apc$countries_present <- NA

for (i in 1:10) {
  key <-
    name_suggest(q = apc$canonicalName[i], rank = 'species')$data$key[1]
  first_species <- occ_search(taxonKey = key, limit = 100000)
  unique_countries <- unique(first_species$data$country)
  apc$countries_present[i] <- paste(unique_countries, collapse = "_")
}

write_csv(apc,"intermediate_data/natives_with_counties_added.csv")
```
further data manipulation was done by our supervisor Will Cornwell and uploaded as a complete Australian Native data frame for us to use for our analysis. 


1.1Combining Invasive species data sets:

US alien invasive flora:
```{r}
gris_us <- read.csv("intermediate_data/gris_us_data.csv")

us_alien <- select(gris_us, scientificName, isInvasive, establishmentMeans)

us_inv <- us_alien %>%
  filter(isInvasive == "Invasive")

us_inv_rename <- rename(us_inv, species = scientificName, for_USA = isInvasive)

write.csv(us_inv_rename, "intermediate_data/US_invasive_method_1.csv")
```

iNaturalist invasive:

```{r}
natives_wc<- read.csv("intermediate_data/natives_with_counties_added.csv")
ausinv <- read.csv("data/aus_invasives_elsewhere.csv")

ausinv <- select(ausinv, -group)
ausinv <- rename(ausinv, 'canonicalName' = species)

join_na_ausinv <- left_join(natives_wc, ausinv, by = "canonicalName")

write.csv(join_na_ausinv,"intermediate_data/natives_with_invasives_method2.csv")

```

Glonaf invasive:
```{r}
glonaf <- read.csv("~/Desktop/Taxon_x_List_GloNAF_vanKleunenetal2018Ecology.csv")
method_2="https://raw.githubusercontent.com/traitecoevo/australian_plant_endemism/master/intermediate_data/natives_with_invasives_method2.csv"
method_2<-read_csv(url(method_2))
glonaf <- rename(glonaf, 'canonicalName' = taxon_orig)
join_glonaf_method2 <-left_join(method_2, glonaf, by = "canonicalName")
write.csv("join_glonaf_method2.csv")
```



2.1 Assessing Endemism: 
```{r}
countries <- read_csv("intermediate_data/country_dataset.csv")
countries$genus <- word(countries$species,1,1)

Pollia <- filter(countries, genus == "Pollia")

countries %>%
  group_by(genus) %>%
  summarize(genus_endemic = all(aus_endemic),
            prop_sp_endemic = sum(aus_endemic)/n()) -> genera

genera %>%
  ggplot(aes(x=prop_sp_endemic))+geom_histogram()

devtools::install_github("wcornwell/taxonlookup")

library(taxonlookup)
lt <- lookup_table(genera$genus, by_species = TRUE)

genera %>%
  left_join(lt) -> genus_with_family

genus_with_family %>%
  group_by(family) %>%
  summarize(prop_endemic = sum(genus_endemic)/n(),n()) -> family_summary

family_summary %>%
  ggplot(aes(x=prop_endemic)) + geom_histogram()

lt <- lookup_table(countries$species, by_species = TRUE)
lt <- rownames_to_column(lt, "species")

left_join(countries, lt) -> species_with_family

species_with_family %>%
  group_by(group) %>%
  summarize(prop_endemic = sum(aus_endemic)/n(), n=n())

```



2.2 Joining IUCN plots:

```{r}
country <- read.csv("intermediate_data/country_dataset.csv")

ICUN <- read.csv("intermediate_data/assessments.csv")

ICUN <- rename(ICUN, 'species' = scientificName)

ICUN_subset <- select(ICUN, species, redlistCategory)

joined_data <- left_join(country, ICUN_subset, by = "species")

subset <- select(joined_data, species, redlistCategory, aus_endemic)

#endemic
endemic_subset <- subset %>%
  group_by(aus_endemic) %>% 
  filter(aus_endemic == "TRUE")

endemic_subset %>% 
  group_by(redlistCategory) %>% 
  summarise(endemic_subset=n())


#nonendemic 
nonendemic_subset <- subset %>%
  group_by(aus_endemic) %>% 
  filter(aus_endemic == "FALSE")

 nonendemic_subset %>% 
  group_by(redlistCategory) %>% 
  summarise(nonendemic_subset=n())
```



2.3 Joining Growth form data and creating growth form plots:
```{r}
#austraits growth form data set 
austraits <- load_austraits(version = "3.0.2", path = "intermediate_data/austraits")

#create new data frame with just the growth form values 
growth_form <- filter(austraits$traits, trait_name == "plant_growth_form") 

#select only necessary info
growth_form_subset <- select(growth_form, taxon_name, value)

#select only first one of each canonical name 
growth_form <- growth_form_subset %>%
  distinct(taxon_name, .keep_all = TRUE)

#Endemic and non-endemic treemap process 
#load endemic dataset 
country <- read.csv("intermediate_data/country_dataset.csv")

#rename taxon to match name_use 
growth_form <- rename(growth_form, 'species' = taxon_name)

#join two datasets 
join_data <- left_join(country, growth_form, by = "species")

#create larger groupings using recode 
complete_group <- join_data %>% 
  group_by(value) %>%
  mutate (group = recode(value, 
                         climber_herb = "climber", 
                         climber_liana = "climber",
                         climber_palm = "climber", 
                         "climber_liana climber_vine" = "climber",
                         climber_scrambler = "climber", 
                         climber_shrub = "climber", 
                         climber_twiner = "climber",
                         climber_vine = "climber", 
                         climber_vine_herbaceous = "climber",
                         climber_vine_woody = "climber",
                         climber_woody = "climber",
                         "climber_shrub climber_tree" = "climber",
                         aquatic_herb = "aquatic",
                         "epiphyte parasite" = "epiphyte", 
                         fern_tree = "fern",
                         graminoid_tussock = "graminoid",
                         "hemi-epiphyte" = "epiphyte", 
                         "herb shrub" = "herb", 
                         "herb subshrub" = "herb", 
                         herb_large = "herb", 
                         parasite_woody = "parasite", 
                         prostrate_herb = "prostrate", 
                         prostrate_shrub = "prostrate", 
                         rosette_erect = "rosette", 
                         "shrub subshrub" = "shrub", 
                         "shrub tree" = "shrub", 
                         "shrub treelet" = "shrub",
                         subshrub = "shrub", 
                         treelet ="tree",
                         cushion = "herb",
                         climber_shrub_climber_tree = "climber",
                         erect_leafy = "herb",
                         long_basal = "herb",
                         "rosette" = "herb",
                         rosette_erect = "herb",
                         semi_basal = "herb", 
                         short_basal = "herb",
                         succulent_short = "succulent",
                         "epiphyte_herb" = "epiphyte"
  ))

#check the grouping values 
unique(complete_group$group)

#select only necessary info
complete_group <- select(complete_group, species, value, aus_endemic, group)

#subset so only endemic
endemic_group <- complete_group %>%
  group_by(aus_endemic) %>% 
  filter(aus_endemic == "TRUE")

#endemic treemap of large groups data 
endemic_group_counts <- endemic_group %>% 
  group_by(group) %>% 
  summarise(num_species=n())

treemap(endemic_group_counts,
        index= "group",
        vSize="num_species",
        type="index", 
        palette = "Set3") 

#nonendemic
#subset so nonendemic
nonendemic_group <- complete_group %>%
  group_by(aus_endemic) %>% 
  filter(aus_endemic == "FALSE")

#nonendemic treemap of large groups data 
nonendemic_group_counts <- nonendemic_group %>% 
  group_by(group) %>% 
  summarise(num_species=n())

treemap(nonendemic_group_counts,
        index= "group",
        vSize="num_species",
        type="index", 
        palette = "Set3") 

```



2.4 Creating Geographical Visulisations:
```{r}
country_count_basic = "https://raw.githubusercontent.com/traitecoevo/australian_plant_endemism/master/intermediate_data/country_counts.csv"
country_count_basic<-read_csv(url(country_count_basic))
View(country_count_basic)

country_count_basic$name<-gsub("_"," ",country_count_basic$Country)
country_count_basic$name<-str_to_title(country_count_basic$name)
country_count_basic["26", "name"] <- "Papua New Guinea"
country_count_basic["26", "Country"] <- "papua_new_guinea"
country_count <- ne_countries(scale = "medium", returnclass = "sf")
class(country_count_basic)

cc<-left_join(country_count,country_count_basic)
View(cc)

ggplot(data = cc) +
  geom_sf(aes(fill = `sum(presence)`),size=0.1)
ggplot(data = cc) +
  geom_sf(aes(fill = `sum(presence)`),size=0.1) +
  scale_fill_viridis_c(option = "plasma")
country_count_basic["26", "name"] <- "Guinea"

```



